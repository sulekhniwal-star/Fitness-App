---
phase: 5
plan: 1
wave: 1
depends_on: []
files_modified: [
  "fitkarma/lib/data/models/post_model.dart",
  "fitkarma/lib/data/providers/community_provider.dart",
  "fitkarma/lib/presentation/screens/home/community_tab.dart"
]
autonomous: true

must_haves:
  truths:
    - "Posts can be fetched from PocketBase and displayed in a clean feed."
    - "Users can create new posts with text and optional images."
  artifacts:
    - "lib/data/models/post_model.dart"
    - "lib/presentation/screens/home/community_tab.dart"
---

# Plan 5.1: Community & Social Feed

<objective>
Establish the social foundation of FitKarma by implementing a real-time community feed where users can share their fitness progress and interact with others.

Purpose: Increase user retention through social accountability and community engagement.
Output: A new 'Community' tab featuring a social feed and post creation flow.
</objective>

<context>
Load for context:
- fitkarma/lib/data/models/user_model.dart
- fitkarma/lib/core/network/pocketbase_client.dart
- fitkarma/lib/presentation/screens/home/home_screen.dart (to add the tab)
</context>

<tasks>

<task type="auto">
  <name>Define Post Model & Collection Sync</name>
  <files>lib/data/models/post_model.dart, lib/data/models/post_model.g.dart</files>
  <action>
    - Create `PostModel` with fields: `id`, `user`, `content`, `imageUrl`, `likes` (List of user IDs), `createdAt`, and `challengeId`.
    - Implement `fromJson` and `toJson` supporting PocketBase record formats.
    - Ensure `Hive` adapters are generated for offline-first post caching (similar to `workout_model.dart`).
  </action>
  <verify>Run `flutter pub run build_runner build` and check for matching `.g.dart` file.</verify>
  <done>PostModel is serializable and Hive-ready.</done>
</task>

<task type="auto">
  <name>Implement Community Tab & Social Feed</name>
  <files>lib/presentation/screens/home/community_tab.dart, lib/data/providers/community_provider.dart</files>
  <action>
    - Create `CommunityTab` as a ConsumerWidget with a `ListView.builder` for posts.
    - Implement `CommunityNotifier` (Riverpod) to fetch posts from PocketBase and manage local state.
    - Build `PostCard` widget showing user avatar, name, content, image (if any), and a 'Like' button.
    - Integrate `RefreshIndicator` for pull-to-refresh functionality.
  </action>
  <verify>Navigating to Community tab shows a scrollable list of mock or real posts.</verify>
  <done>Users can view a feed of community updates.</done>
</task>

<task type="auto">
  <name>Build Post Creation Flow</name>
  <files>lib/presentation/screens/home/community_tab.dart</files>
  <action>
    - Add a FloatingActionButton to `CommunityTab` for "New Post".
    - Implement a simple BottomSheet or Dialog to input text content.
    - Hook into `communityProvider` to save the post to PocketBase and update the local feed.
    - Add success/error feedback using `ScaffoldMessenger`.
  </action>
  <verify>Clicking FAB + entering text + submitting adds a new post to the top of the feed.</verify>
  <done>Users can share their own updates with the community.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Posts are fetched and rendered with user details.
- [ ] New posts are successfully synced to PocketBase.
- [ ] Pull-to-refresh updates the feed state.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
