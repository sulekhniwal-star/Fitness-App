---
phase: 5
plan: 3
wave: 2
depends_on: [1, 2]
files_modified: [
  "fitkarma/lib/data/providers/leaderboard_provider.dart",
  "fitkarma/lib/presentation/screens/profile/leaderboard_tab.dart",
  "fitkarma/lib/presentation/screens/profile/profile_screen.dart"
]
autonomous: true

must_haves:
  truths:
    - "Users can see a ranked list of top performers based on Karma points."
    - "The current user's rank is highlighted in the list."
  artifacts:
    - "lib/presentation/screens/profile/leaderboard_tab.dart"
---

# Plan 5.3: Karma Leaderboard & Rankings

<objective>
Visualize user competition through a Karma-based leaderboard, rewarding high-activity users with social status.

Purpose: Gamify the experience and provide a clear vanity metric for top users.
Output: A toggleable Leaderboard view within the Profile/Social area.
</objective>

<context>
Load for context:
- fitkarma/lib/data/models/user_model.dart
- fitkarma/lib/presentation/screens/profile/profile_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Implement Leaderboard Provider</name>
  <files>lib/data/providers/leaderboard_provider.dart</files>
  <action>
    - Create `leaderboardProvider` that fetches users from PocketBase sorted by `karma_points` in descending order.
    - Limit the initial fetch to the top 50 users for performance.
    - Implement caching to prevent frequent network calls.
  </action>
  <verify>Provider returns a list of UserModels sorted by Karma points.</verify>
  <done>Ranking data is available and sorted correctly.</done>
</task>

<task type="auto">
  <name>Build Leaderboard UI</name>
  <files>lib/presentation/screens/profile/leaderboard_tab.dart</files>
  <action>
    - Create `LeaderboardTab` featuring a list of users with their rank, avatar, name, and total Karma.
    - Add special styling for the top 3 ranks (Gold, Silver, Bronze indicators).
    - Ensure the current user's entry is visually distinct (e.g., highlighted background).
  </action>
  <verify>Leaderboard shows sorted users with clear rank numbering.</verify>
  <done>Users can see how they compare to the community.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Users are sorted correctly by Karma points.
- [ ] Top 3 users have distinct visual markers.
- [ ] Current user rank is easily identifiable.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
