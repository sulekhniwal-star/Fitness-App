---
phase: 5
plan: 2
wave: 1
depends_on: [1]
files_modified: [
  "fitkarma/lib/data/models/challenge_model.dart",
  "fitkarma/lib/data/providers/challenge_provider.dart",
  "fitkarma/lib/presentation/screens/home/community_tab.dart"
]
autonomous: true

must_haves:
  truths:
    - "Users can see a horizontal list of active challenges inside the Community tab."
    - "Users can join a challenge, which updates their status in PocketBase."
  artifacts:
    - "lib/data/models/challenge_model.dart"
    - "lib/data/providers/challenge_provider.dart"
---

# Plan 5.2: Challenges & Enrollment System

<objective>
Introduce 'Community Challenges' to gamify fitness goals and encourage group participation.

Purpose: Drive daily active usage (DAU) through time-bound collective goals.
Output: A Challenge section in the community feed and enrollment logic.
</objective>

<context>
Load for context:
- fitkarma/lib/data/models/post_model.dart
- .gsd/phases/5/5.1-community-social.md
</context>

<tasks>

<task type="auto">
  <name>Define Challenge Model</name>
  <files>lib/data/models/challenge_model.dart, lib/data/models/challenge_model.g.dart</files>
  <action>
    - Define `ChallengeModel`: `id`, `title`, `description`, `goalType` (steps/workout/etc), `goalValue`, `rewardPoints`, `startDate`, `endDate`, `participantsCount`.
    - Generate Hive adapters for offline caching.
  </action>
  <verify>Run build_runner and confirm `.g.dart` creation.</verify>
  <done>ChallengeModel is structured and serializable.</done>
</task>

<task type="auto">
  <name>Implement Challenge Section in Community Tab</name>
  <files>lib/presentation/screens/home/community_tab.dart, lib/data/providers/challenge_provider.dart</files>
  <action>
    - Add a horizontal `ListView` at the top of `CommunityTab` to display active challenges.
    - Create `ChallengeCard` widget showing title, reward, and progress snippet.
    - Implement `ChallengeNotifier` to fetch current active challenges from PocketBase.
  </action>
  <verify>Community tab now features a 'Challenges' section above the social feed.</verify>
  <done>Active challenges are visible to all users.</done>
</task>

<task type="auto">
  <name>Challenge Enrollment & Detail View</name>
  <files>lib/presentation/screens/home/community_tab.dart</files>
  <action>
    - Implement a detail Modal/BottomSheet when a `ChallengeCard` is clicked.
    - Add a "Join Challenge" button that adds the user to the challenge's participants list in PocketBase.
    - Show an "Enrolled" badge once the user is successfully joined.
  </action>
  <verify>Joining a challenge updates the UI and persists the participant status.</verify>
  <done>Users can participate in community challenges.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Active challenges are fetched from the server.
- [ ] Users can join challenges and see reflected state.
- [ ] UI handles empty challenge state gracefully.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
