---
phase: 3
plan: 3
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Weight inputs map directly computing user BMI accurately reflecting locally."
    - "A unified graphical chart monitors weight/BMI dynamically over `Hive` states."
  artifacts:
    - "lib/presentation/screens/profile/health_tab.dart"
---

# Plan 3.3: Weight & BMI Tracking

<objective>
Establish a robust weight tracker saving locally into Hive and logging histories for visualizing metrics automatically plotted against the user profile's height.

Purpose: Vital long-term progress metrics independent of pedometer steps.
Output: Real explicit BMI categories natively accessible on their dashboard accurately.
</objective>

<context>
Load for context:
- fitkarma/lib/data/models/user_model.dart
- fitkarma/lib/data/providers/auth_provider.dart
</context>

<tasks>

<task type="auto">
  <name>Construct Weight Data Structures</name>
  <files>lib/data/models/weight_log_model.dart</files>
  <action>
    - Ensure a `WeightLogModel` Hive object stores histories accurately with IDs, Dates, Weight, matching explicitly locally avoiding data overrides.
    - Setup `flutter_riverpod` managing weight insertion natively updating the master `UserModel.weightKg` explicitly when changed modifying the baseline.
    - Synchronize new states accurately mapping `syncServiceProvider` records queue explicitly defining `action: update, collection: users` natively tracking metrics securely.
  </action>
  <verify>Riverpod safely resolves the weight models into explicit logic cleanly rendering history without explicit connection dependencies safely.</verify>
  <done>User updates their profile syncing native history directly generating BMI maps seamlessly.</done>
</task>

<task type="auto">
  <name>Build Health Tab UI</name>
  <files>lib/presentation/screens/profile/health_tab.dart</files>
  <action>
    - Add a specialized `HealthTab` sub-screen linking explicitly into the root Profile menu.
    - Implement a visual layout resolving the current BMI state categorizations ('Normal', 'Overweight') rendering explicitly relative to Indian metrics.
    - Use `fl_chart` plotting the historical `WeightLogModel` arrays accurately showing line graph metrics capturing trends perfectly over Riverpod.
    - Add a dialog updating new weight/height inputs actively.
  </action>
  <verify>Health metrics display charts representing explicitly the actual user inputs tracking data visually seamlessly parsing history models cleanly.</verify>
  <done>Comprehensive health arrays match data without failing native null constraints perfectly.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] BMI natively updates without errors locally saving effectively into Pocketbase synced engines explicitly safely updating historical metrics correctly mapped securely.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
