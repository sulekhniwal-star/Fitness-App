---
phase: 3
plan: 2
wave: 2
depends_on: [1]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "YouTube integration maps correctly to the embedded player rendering securely without blocking permissions."
    - "Completing workouts directly hooks into SyncService and KarmaNotifier natively granting explicitly calculated rewards."
  artifacts:
    - "lib/presentation/screens/workouts/workout_list_screen.dart"
    - "lib/presentation/screens/workouts/workout_detail_screen.dart"
---

# Plan 3.2: Workout Library & Player UI

<objective>
To build out the visual catalog bridging the WorkoutProvider allowing users to seamlessly browse cultural variants, viewing standard YouTube plugins, generating logs natively mapped through explicitly computed `caloriesPerMin` offline structures.

Purpose: Free high-quality local-first engagement bypassing custom video hosting.
Output: Usable workout streams logging into Hive natively upon completion.
</objective>

<context>
Load for context:
- fitkarma/lib/presentation/screens/workouts/workout_list_screen.dart
- fitkarma/pubspec.yaml (checking `youtube_player_flutter` implementation)
- fitkarma/lib/data/providers/karma_provider.dart
</context>

<tasks>

<task type="auto">
  <name>Build Video Library Screens</name>
  <files>lib/presentation/screens/workouts/workout_list_screen.dart, lib/presentation/screens/workouts/workout_detail_screen.dart</files>
  <action>
    - Ensure `WorkoutListScreen` accesses generic tags mapping them as visually distinct cards inside a grid (Bollywood/Yoga distinct lists).
    - Map `onTap` logic launching `WorkoutDetailScreen`.
    - Setup `youtube_player_flutter` inside `WorkoutDetailScreen` rendering standard API keys caching cleanly overriding visual errors with standard Flutter fallbacks natively.
  </action>
  <verify>Riverpod safely resolves workout logic into visual containers handling video loads properly natively without network permission drops.</verify>
  <done>User views working streams mapping explicitly to native app layouts efficiently.</done>
</task>

<task type="auto">
  <name>Workout Execution & Karma Grant</name>
  <files>lib/presentation/screens/workouts/workout_detail_screen.dart</files>
  <action>
    - Inject an "I completed this!" button appending a `WorkoutLogModel` representing a generalized 'duration * intensity' tracking metric.
    - Synchronize to the backend using `SyncService.enqueueAction('workout_logs')`.
    - Grant explicit Karma points safely (`15 -> 'Completed 10 min Yoga'`).
    - Save local metrics directly mapping statistics backwards to pie charts natively.
  </action>
  <verify>Completing the video executes states saving explicitly avoiding data traps safely triggering notifications.</verify>
  <done>Full completion natively updates background statistics providing valid tokens efficiently.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Karma triggers perfectly without duplicated logs cleanly pushing to `Pocketbase`.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
