---
phase: 1
plan: 5
wave: 3
---

# Plan 1.5: Offline Sync Engine

## Objective
Implement an offline-first synchronization engine writing to Hive locally and queuing requests for backend synchronization with PocketBase.

## Context
- lib/core/sync/
- lib/core/storage/

## Tasks

<task type="auto">
  <name>Build Sync Service</name>
  <files>lib/core/sync/sync_service.dart</files>
  <action>
    - Create a `SyncService` provider listening for Internet connectivity changes using Riverpod + `connectivity_plus`.
    - Add listener logic to parse `syncQueueBox` and run a `while` loop that takes items off the queue and posts `create`/`update`/`delete` commands to PocketBase.
    - Add exponential back-off retries and ensure client-wins conflict resolution.
  </action>
  <verify>Mock a local creation of a food component and assert `SyncService` empties queue when 'online'.</verify>
  <done>Sync queue successfully relays local actions to backend automatically.</done>
</task>

## Success Criteria
- [ ] Connectivity monitoring handles transitions flawlessly
- [ ] Mutations follow Hive -> Queue -> Server path
