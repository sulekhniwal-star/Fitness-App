---
phase: 6
plan: 4
wave: 2
depends_on: [1]
files_modified: [
  "fitkarma/lib/data/providers/meal_planner_provider.dart",
  "fitkarma/lib/presentation/screens/home/meal_planner_screen.dart"
]
autonomous: true

must_haves:
  truths:
    - "Provides a 7-day meal plan based on the user's Dosha, allergens, and dietary preference (Veg/Non-Veg)."
    - "Works entirely offline using a local rule-based engine."
  artifacts:
    - "lib/presentation/screens/home/meal_planner_screen.dart"
---

# Plan 6.4: AI-Powered Meal Planner (Rule-based)

<objective>
Provide personalized 7-day meal plans without ongoing API costs, leveraging the user's Ayurvedic profile and dietary preferences.

Purpose: High-value feature with zero operational cost (purely client-side logic).
Output: 7-day rolling meal plan UI.
</objective>

<context>
Load for context:
- fitkarma/lib/data/providers/dosha_provider.dart
- fitkarma/lib/data/models/user_model.dart
</context>

<tasks>

<task type="auto">
  <name>Implementation of Meal Repository</name>
  <files>lib/data/providers/meal_planner_provider.dart</files>
  <action>
    - Define a local database of 100+ Indian meals categorized by Dosha suitability, calories, and time of day.
    - Implement a rule-based algorithm: User(Dosha, Preference, Calories) -> Weekly Schedule.
    - Ensure meal variety (rotational logic).
  </action>
  <verify>Algorithm generates a valid 7-day plan given a sample user profile.</verify>
  <done>Meal planning logic is implemented.</done>
</task>

<task type="auto">
  <name>Meal Planner UI</name>
  <files>lib/presentation/screens/home/meal_planner_screen.dart</files>
  <action>
    - Create a weekly swipeable calendar or list view.
    - Show Breakfast, lunch, dinner details with "Exchange" option (regenerate specific meal).
    - Add "Add to Diary" shortcut to quickly log planned meals.
  </action>
  <verify>Users can view their weekly plan and log meals directly from it.</verify>
  <done>The meal planner is user-facing and interactive.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Meals suggested match the user's Dosha type.
- [ ] Veg users never receive non-veg suggestions.
- [ ] The "Regenerate" function produces a different suitable meal.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
