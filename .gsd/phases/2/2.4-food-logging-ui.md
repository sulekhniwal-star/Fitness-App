---
phase: 2
plan: 4
wave: 2
depends_on: [1, 3]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Food interface queries the FoodProvider seamlessly."
    - "Saving a meal grants the user Karma via KarmaProvider."
  artifacts:
    - "lib/presentation/screens/food/food_search_delegate.dart"
    - "lib/presentation/screens/food/food_logging_screen.dart"
---

# Plan 2.4: Food Logging UI & Actions

<objective>
Update the presentation layers to use `FoodProvider` and `barcode_scan2` scanning to find standard/Indian items, map it to `FoodLogModel`, save it into Hive via the offline-first Sync engine, and issue Karma.

Purpose: Making food logging accessible and rewarding, hooking UI backends.
Output: Real data flowing through the UI.
</objective>

<context>
Load for context:
- lib/data/models/food_log_model.dart
- lib/data/providers/food_provider.dart
- lib/data/providers/karma_provider.dart
- lib/presentation/screens/food/food_logging_screen.dart
</context>

<tasks>

<task type="auto">
  <name>Search API & Barcode Scanning UI</name>
  <files>lib/presentation/screens/food/food_search_delegate.dart, lib/presentation/screens/food/food_logging_screen.dart</files>
  <action>
    - Add a `SearchDelegate` implementation searching over `FoodProvider`'s state.
    - Implement a `barcode_scan2` trigger button in `FoodLoggingScreen` taking standard ISBN/EAN strings and proxying it through the `FoodProvider`.
    - Present the returned list of options cleanly resolving to mock API items if the network drops (catching it gracefully).
  </action>
  <verify>The `barcode_scan` library is imported fully without breaking builds; Search UI functions responsively.</verify>
  <done>User can successfully query custom food items visually.</done>
</task>

<task type="auto">
  <name>Logging Flow & Karma Sync</name>
  <files>lib/presentation/screens/food/food_logging_screen.dart</files>
  <action>
    - Create a dialog resolving the specific item, capturing meal type, quantity/calories.
    - Upon 'Save' selection, generate a `FoodLogModel` hitting caching rules.
    - Call `SyncService` enqueue resolving mutations off the server.
    - Fire a `KarmaNotifier.earnKarma(3, 'Logged meal')` to invoke points instantly.
    AVOID: Complex UI overthinking; focus on data pipes.
  </action>
  <verify>Submitting the form fires off the `KarmaNotifier` locally.</verify>
  <done>Food is successfully listed under the day's meals permanently.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Meals sync locally successfully giving karma points safely.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
