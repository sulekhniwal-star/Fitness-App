---
phase: 2
plan: 2
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "A background stream provides live device step monitoring."
    - "Calculations process steps into 'Cricket Overs' intuitively."
  artifacts:
    - "lib/data/providers/step_provider.dart"
---

# Plan 2.2: Pedometer & Step Provider

<objective>
Configure the internal `pedometer` plugin dependency and Riverpod structure mapping steps and linking them directly to the user's statistics, caching into Hive to prevent arbitrary data loss on restarts.

Purpose: Driving daily activity engagement via background step tracking and unique cultural metrics.
Output: Background active pedometer state ready for consumption.
</objective>

<context>
Load for context:
- pubspec.yaml (checking health/pedometer plugin names)
- lib/core/storage/hive_service.dart
</context>

<tasks>

<task type="auto">
  <name>Pedometer Service Initialization</name>
  <files>lib/data/providers/step_provider.dart</files>
  <action>
    - Utilize `pedometer` or iOS equivalents bridging device streams over `Pedometer.stepCountStream`.
    - Apply a calculation formula: every 6 steps = 0.1 over. e.g. 500 steps = 83.2 overs.
    - Write a mechanism to record step values mapping specifically relative to the local `DateTime.now().year/month/day` cache so restarts don't lose daily goals.
    - Store this into `HiveService.stepsBox`.
    AVOID: Keeping extreme streams attached over memory when deactivated.
  </action>
  <verify>Riverpod provider exposes `StepState` holding today's step count without crashing.</verify>
  <done>Stream correctly listens bridging pedometer values into Riverpod application state.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Permissions request setup for activity tracking is present
- [ ] State resolves the overs calculation properly
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
