---
phase: 4
plan: 3
wave: 1
depends_on: []
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Mixpanel and Sentry correctly integrate capturing core events passively."
    - "No runtime crashes occur on missing initialization API keys."
  artifacts:
    - "lib/core/monitoring/analytics_service.dart"
---

# Plan 4.3: Analytics & Monitoring Setup

<objective>
Integrate tracking SDKs (Mixpanel / Sentry) ensuring stable crash reporting and behavioral metric capture mapping interactions silently.

Purpose: Production-grade app requires explicit user metric tracking and bug resolving telemetry.
Output: Silent services hooking navigation and key button clicks resolving metrics correctly.
</objective>

<context>
Load for context:
- fitkarma/pubspec.yaml
- fitkarma/lib/main.dart
</context>

<tasks>

<task type="auto">
  <name>Add Tracking SDK dependencies</name>
  <files>pubspec.yaml, lib/core/monitoring/analytics_service.dart</files>
  <action>
    - Add `mixpanel_flutter` and `sentry_flutter` to `pubspec.yaml` resolving `flutter pub get`.
    - Create `AnalyticsService` singleton exposing `trackEvent()` and `setUserProperties()` safely.
    - Integrate Mock variants when environment variables fall short executing silently avoiding crashes tracking natively.
  </action>
  <verify>Dart completely resolves SDK implementations locally installing perfectly.</verify>
  <done>Mixpanel services successfully abstract tracking without hard crashes.</done>
</task>

<task type="auto">
  <name>Initialize App-wide Monitoring</name>
  <files>lib/main.dart, lib/core/utils/router.dart</files>
  <action>
    - Wrap `main()` executing `SentryFlutter.init` trapping global uncaught exceptions safely.
    - Add a specialized `NavigatorObserver` in `go_router` parsing page navigations into `AnalyticsService.trackEvent()`.
  </action>
  <verify>App wraps standard loops catching logic inside Sentry efficiently mapping navigations natively.</verify>
  <done>Full tracking scope connects flawlessly identifying views smoothly.</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Crash handlers map successfully wrapping UI environments explicitly reporting natively.
</verification>

<success_criteria>
- [ ] All tasks verified
- [ ] Must-haves confirmed
</success_criteria>
