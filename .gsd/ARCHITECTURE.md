# Architecture

> Auto-generated by /map on 2026-02-25

## Overview

FitKarma is a cross-platform fitness application built with Flutter. It utilizes an offline-first architecture where data is stored locally via Hive and background-synced to a PocketBase backend using Riverpod for state management. The app uses a domain-driven and feature-based folder structure, separating core utilities, data management, business logic (domain/features), and presentation.

```text
┌─────────────────────────────────────────┐
│     [Presentation Layer (Screens)]      │
│     (Riverpod Consumers & Widgets)      │
├─────────────────────────────────────────┤
│            [State Management]           │
│     (Riverpod Providers / Notifiers)    │
├─────────────────────────────────────────┤
│    [Domain Layer] & [Features Layer]    │
│    (Business Logic / Use Cases)         │
├─────────────────────────────────────────┤
│            [Data Layer]                 │
│    (Repositories / Models)              │
├─────────────────────────────────────────┤
│ [Local DB (Hive)] | [Remote (PocketBase)]│
└─────────────────────────────────────────┘
```

## Components

### Core Utilities
- **Purpose:** Core networking, storage, theme, sync configuration, monitoring, and general utils.
- **Location:** `lib/core/`

### Data Layer
- **Purpose:** Contains data models, repositories to manage API/DB calls, and Riverpod providers.
- **Location:** `lib/data/` (Models, Providers, Repositories)

### Domain & Features
- **Purpose:** Business logic, feature-specific flows (auth, dashboard, food, karma, workouts) and domain interfaces.
- **Location:** `lib/domain/` & `lib/features/`

### Presentation Layer
- **Purpose:** The UI layer split into reusable widgets and specific screens by module (auth, food, home, profile, workouts).
- **Location:** `lib/presentation/`

## Data Flow

1. **User Action:** UI widget is triggered in `lib/presentation`.
2. **State Management:** Method is called on a Riverpod Notifier/Provider.
3. **Repository Execution:** The provider uses a Repository (`lib/data/repositories`) to handle the request.
4. **Local DB Update:** The repository writes to Hive for immediate UI updates (Offline-first).
5. **Background Sync:** A sync queue process attempts to push data to PocketBase.

## Integration Points

| Service | Type | Purpose |
|---------|------|---------|
| PocketBase | Backend | Remote Database, Authentication, File Storage |
| Hive | Local DB | Offline data persistence |
| Google ML Kit | SDK | Text Recognition / OCR parsing |
| Pedometer / Health | SDK | Background step tracking / health stats |
| YouTube Player | API | Rendering workout routine videos |
| Razorpay | API | Subscriptions & payments |

## Technical Debt

- [ ] Implement OTP verification with PocketBase (`lib/presentation/screens/auth/phone_otp_screen.dart:47`)
- [ ] Implement resend OTP (`lib/presentation/screens/auth/phone_otp_screen.dart:142`)
- [ ] Navigate to settings (`lib/presentation/screens/profile/profile_screen.dart:33`)

## Conventions

**Naming:** PascalCase for classes, camelCase for variables/methods, snake_case for file names.
**Structure:** Clean Architecture hybrid structure (combining layer-first and feature-first patterns).
**Testing:** Base `test/` directory. Uses `hive_generator` and `riverpod_generator` for build generation patterns.
